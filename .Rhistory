library(readr)
# read in clinicaltrials.gov data
chunks <- c(1:6)
cancer_trials <- data_frame()
for (ch in chunks) {
print(ch)
tmp <- read_csv(paste0("https://clinicaltrials.gov/ct2/results/download_fields?cond=cancer&down_flds=all&down_count=10000&down_fmt=csv&down_chunk=",ch))
cancer_trials <- bind_rows(cancer_trials,tmp)
}
library(dplyr)
library(readr)
setwd("~/Dropbox/berkeley/2017dataviz/Sonali Verma/sonali-verma")
# export data
write_csv(cancer_trials, "data/clinicaltrials.csv", na="")
chunks <- c(1:6)
cancer_trials <- data_frame()
for (ch in chunks) {
print(ch)
tmp <- read_csv(paste0("https://clinicaltrials.gov/ct2/results/download_fields?cond=cancer&down_flds=all&down_count=10000&down_fmt=csv&down_chunk=",ch))
cancer_trials <- bind_rows(cancer_trials,tmp)
}
View(cancer_trials)
cancer_trials_conditions <- cancer_trials %>%
group_by(Conditions) %>%
summarize(number = n())
View(cancer_trials_conditions)
View(cancer_trials)
cancer_trials_conditions <- cancer_trials %>%
group_by(Conditions) %>%
summarize(number = n()) %>%
arrange(desc(number))
View(cancer_trials_conditions)
breast_cancer_trials <- cancer_trials %>%
filter(grepl("Breast") & !grepl("Prostate") & !grepl("Lung") & !grepl("Colorectal") & !grepl("Myeloma"))
breast_cancer_trials <- cancer_trials %>%
filter(grepl("Breast", Conditions) & !grepl("Prostate", Conditions) & !grepl("Lung", Conditions) & !grepl("Colorectal", Conditions) & !grepl("Myeloma", Conditions))
View(breast_cancer_trials)
breast_cancer_trials <- cancer_trials %>%
filter(grepl("Breast", Conditions) & !grepl("Prostate", Conditions) & !grepl("Lung", Conditions) & !grepl("Colorectal", Conditions) & !grepl("Myeloma", Conditions)) %>%
mutate(type = "Breast")
prostate_cancer_trials <- cancer_trials %>%
filter(grepl("Prostate", Conditions) & !grepl("Breast", Conditions) & !grepl("Lung", Conditions) & !grepl("Colorectal", Conditions) & !grepl("Myeloma", Conditions)) %>%
mutate(type = "Prostate")
View(prostate_cancer_trials)
lung_cancer_trials <- cancer_trials %>%
filter(grepl("Lung", Conditions) & !grepl("Breast", Conditions) & !grepl("Prostate", Conditions) & !grepl("Colorectal", Conditions) & !grepl("Myeloma", Conditions)) %>%
mutate(type = "Lung")
View(lung_cancer_trials)
colorectal_cancer_trials <- cancer_trials %>%
filter(grepl("Colorectal", Conditions) & !grepl("Breast", Conditions) & !grepl("Prostate", Conditions) & !grepl("Lung", Conditions) & !grepl("Myeloma", Conditions)) %>%
mutate(type = "Colorectal")
View(colorectal_cancer_trials)
myeloma_cancer_trials <- cancer_trials %>%
filter(grepl("Myeloma", Conditions) & !grepl("Breast", Conditions) & !grepl("Prostate", Conditions) & !grepl("Lung", Conditions) & !grepl("Colorectal", Conditions)) %>%
mutate(type = "Myeloma")
# combine the filtered and reclassified trials
selected_cancer_trials <- bind_rows(breast_cancer_trials,prostate_cancer_trials,lung_cancer_trials,colorectal_cancer_trials,myeloma_cancer_trials)
# antijoin to filter against other trials
other_cancer_trials <- antijoin(cancer_trials,selected_cancer_trials)
# anti join to filter against other trials
other_cancer_trials <- anti_join(cancer_trials,selected_cancer_trials)
other_cancer_trials <- anti_join(cancer_trials,selected_cancer_trials) %>%
mutate(tyoe = "Other")
other_cancer_trials <- anti_join(cancer_trials,selected_cancer_trials) %>%
mutate(type = "Other")
# recombine reclassified data
cancer_trials <- bind_rows(selected_cancer_trials,other_cancer_trials)
View(cancer_trials)
View(cancer_trials)
cancer_trials <- cancer_trials %>%
mutate(start_year = (gsub("[^0-9]", "", `Start Date`))
cancer_trials <- cancer_trials %>%
mutate(start_year = gsub("[^0-9]", "", `Start Date`))
View(cancer_trials)
cancer_trials <- cancer_trials %>%
mutate(start_year = substr(`Start Date`, nchar(`Start Date`)-4))
cancer_trials <- cancer_trials %>%
mutate(start_year = substr(`Start Date`, nchar(`Start Date`)-4), nchar(`Start Date`))
cancer_trials <- cancer_trials %>%
mutate(start_year = substr(`Start Date`, nchar(`Start Date`)-4), nchar(`Start Date`))
cancer_trials <- cancer_trials %>%
mutate(start_year = substr(`Start Date`, nchar(`Start Date`)-4, nchar(`Start Date`))
)
View(cancer_trials)
# replace "null" in all columns with NA
cancer_trials[cancer_trials == "null"] <- NA
View(cancer_trials)
cancer_trials_us <- cancer_trials %>%
filter(grepl("United States",Locations))
View(cancer_trials_us)
state.name
for (state in state.name) {
cancer_trials_us <- cancer_trials_us %>%
mutate(state = (state %in% Locations))
}
View(cancer_trials_us)
for (state in state.name) {
cancer_trials_us <- cancer_trials_us %>%
mutate(assign(state) = (state %in% Locations))
}
for (state in state.name) {
cancer_trials_us <- cancer_trials_us %>%
mutate(assign(state) <- (state %in% Locations))
}
for (state in state.name) {
cancer_trials_us <- cancer_trials_us %>%
mutate(assign(state, state %in% Locations))
}
for (state in state.name) {
cancer_trials_us <- cancer_trials_us %>%
mutate(assign(state), state %in% Locations))
}
for (state in state.name) {
cancer_trials_us <- cancer_trials_us %>%
mutate(assign(state), state %in% Locations)
}
for (state in state.name) {
print(state)
cancer_trials_us <- cancer_trials_us %>%
mutate(state.name[n] = state %in% Locations)
n <- n+1
}
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us <- cancer_trials_us %>%
mutate(state.name[n] = state %in% Locations)
n <- n+1
}
for (state in state.name) {
print(state)
cancer_trials_us <- cancer_trials_us %>%
mutate(state.name[n] = state %in% Locations)
n <- n+1
}
cancer_trials_us <- cancer_trials_us %>%
mutate(state.name[n] = state %in% Locations)
state.name[n]
state %in% Locations
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us <- cancer_trials_us %>%
mutate(state.name[n] = state %in% cancer_trials_us$Locations)
n <- n+1
}
for (state in state.name) {
print(state)
cancer_trials_us <- cancer_trials_us %>%
mutate(state.name[n] = (state %in% cancer_trials_us$Locations))
n <- n+1
}
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us <- cancer_trials_us %>%
mutate(state.name[n] = grepl(state,Locations))
n <- n+1
}
cancer_trials_us <- cancer_trials_us %>%
mutate(state.name[n] = grepl(state,Locations))
grepl(state,Locations)
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us <- cancer_trials_us %>%
mutate(state.name[n] = grepl(state,cancer_trials_us$Locations))
n <- n+1
}
grepl(state,cancer_trials_us$Locations)
for (state in state.name) {
print(state)
cancer_trials_us <- cancer_trials_us %>%
mutate(assign(state.name[n],grepl(state,cancer_trials_us$Locations)))
n <- n+1
}
View(cancer_trials_us)
View(cancer_trials_us)
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us <- cancer_trials_us %>%
mutate(state.name[n] = grepl(state,cancer_trials_us$Locations))
n <- n+1
}
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us$state.name[n] <- grepl(state,cancer_trials_us$Locations)
n <- n+1
}
View(cancer_trials_us)
# filter only for trials in US
cancer_trials_us <- cancer_trials %>%
filter(grepl("United States",Locations))
View(cancer_trials_us)
n <- 1
for (state in state.name) {
print(state)
assign(cancer_trials_us$state.name[n], grepl(state, cancer_trials_us$Locations))
n <- n+1
}
n <- 1
for (state in state.name) {
print(state)
assign(cancer_trials_us$state.name[[n]], grepl(state, cancer_trials_us$Locations))
n <- n+1
}
cancer_trials_us$state.name[[n]]
n <- 1
for (state in state.name) {
print(state)
assign(n, grepl(state, cancer_trials_us$Locations))
}
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us$state.name[n] <<- grepl(state, cancer_trials_us$Locations)
n <- n+1
}
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us$state.name[n] <<- grepl(state, cancer_trials_us$Locations)
n <- n+1
}
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us$state.name[n] <- grepl(state, cancer_trials_us$Locations)
n <- n+1
}
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us[[state]] <- grepl(state, cancer_trials_us$Locations)
n <- n+1
}
View(cancer_trials_us)
# replace TRUE from this evaluation with 1
cancer_trials_us[cancer_trials_us == 1] <- TRUE
# replace FALSE from this evaluation with 0
cancer_trials_us[cancer_trials_us == 0] <- FALSE
View(cancer_trials_us)
cancer_trials_us[cancer_trials_us == 1] <- "TRUE"
# replace FALSE from this evaluation with 0
cancer_trials_us[cancer_trials_us == 0] <- "FALSE"
View(cancer_trials_us)
cancer_trials_us[cancer_trials_us == TRUE] <- 1
# replace FALSE from this evaluation with 0
cancer_trials_us[cancer_trials_us == FALSE] <- 0
View(cancer_trials_us)
View(cancer_trials_us)
cancer_trials_us <- cancer_trials %>%
filter(grepl("United States",Locations))
# this creates a new column for each state, and tests whether the location includes that state name
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us[[state]] <- grepl(state, cancer_trials_us$Locations)
n <- n+1
}
# replace TRUE from this evaluation with 1
cancer_trials_us[cancer_trials_us == TRUE] <- 1
# replace FALSE from this evaluation with 0
cancer_trials_us[cancer_trials_us == FALSE] <- 0
x <- matrix(runif(100), ncol = 5)
group <- sample(1:8, 20, TRUE)
(xsum <- rowsum(x, group))
## Slower versions
tapply(x, list(group[row(x)], col(x)), sum)
t(sapply(split(as.data.frame(x), group), colSums))
aggregate(x, list(group), sum)[-1]
x <- matrix(runif(100), ncol = 5)
View(x)
group <- sample(1:8, 20, TRUE)
(xsum <- rowsum(x, group))
cancer_trials_us <- cancer_trials_us %>%
mutate(number_states = RowSums(state.name))
View(cancer_trials_us)
cancer_trials_us$number_states = rowSums(cancer_trials_us[,c(33:82)])
View(cancer_trials_us)
cancer_trials_us_multiple <- cancer_trials_us %>%
filter(number_states > 1) %>%
mutate(multi_single_state = "multiple")
cancer_trials_us_multiple <- cancer_trials_us %>%
filter(number_states > 1) %>%
mutate(state = "multiple")
View(cancer_trials_us_multiple)
library(stringr)
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us_single <- cancer_trials_us_single %>%
mutate(state = str_extract(state, Locations))
n <- n+1
}
cancer_trials_us_single <- cancer_trials_us %>%
filter(number_states == 1)
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us_single <- cancer_trials_us_single %>%
mutate(state = str_extract(state, Locations))
n <- n+1
}
View(cancer_trials_us_multiple)
View(cancer_trials_us_single)
n <- 1
for (state in state.name) {
print(state)
cancer_trials_us_single <- cancer_trials_us_single %>%
mutate(state = str_extract(state, Locations))
n <- n+1
}
str_extract(state, Locations)
state.name[state.name %in% cancer_trials_us_single$Locations]
state.name %in% cancer_trials_us_single$Locations
text[state.name %in% cancer_trials_us_single$Locations]
arg <- grepl(state.name, cancer_trials_us_single$Locations)
cancer_trials_us_single <- cancer_trials_us %>%
filter(number_states == 1) %>%
mutate(state = gsub(paste0("[^", paste(state.name, collapse=""), "]+"), "", Locations))
View(cancer_trials_us)
View(cancer_trials_us_single)
paste(state.name, collapse="")
cancer_trials_us_single <- cancer_trials_us %>%
filter(number_states == 1) %>%
mutate(state = gsub(paste0("[^", paste(state.name, collapse=" "), "]+"), "", Locations))
View(cancer_trials_us_single)
cancer_trials_us_single <- cancer_trials_us %>%
filter(number_states == 1) %>%
mutate(state = gsub(paste0("[", paste(state.name, collapse=" "), "]+"), "", Locations))
View(cancer_trials_us_single)
cancer_trials_us_multiple <- cancer_trials_us %>%
filter(number_states > 1) %>%
mutate(state = "multiple")
cancer_trials_us_single <- cancer_trials_us %>%
filter(number_states == 1) %>%
mutate(state = gsub(paste0("[^", paste(state.name, collapse=" "), "]+"), "", Locations))
View(cancer_trials_us_single)
state.name
cancer_trials_us_single <- cancer_trials_us_single %>%
filter(number_states == 1) %>%
mutate(state = str_extract_all(Locations,state.name))
cancer_trials_us_single <- cancer_trials_us_single %>%
filter(number_states == 1) %>%
mutate(state = str_match(Locations,state.name))
cancer_trials_us_single <- cancer_trials_us_single %>%
filter(number_states == 1) %>%
mutate(state = str_match(Locations,state.name))
cancer_trials_us_single <- cancer_trials_us_single %>%
filter(number_states == 1) %>%
mutate(state = str_match(state.name, Locations))
write_csv(refineries_demo_release, 'refineries_demo_release.csv', na="")
# load required packages
library(tidycensus)
library(rgdal)
library(readr)
library(dplyr)
library(tigris)
readRenviron("~/.Renviron")
population_2010 <- get_decennial(geography = "state",
variables = "B01003_001",
year = 2010) %>%
rename(population = estimate)  %>%
select(1,2,4)
population_2010 <- get_decennial(geography = "state",
sumfile = "sf1",
variables = "B01003_001",
year = 2010)
# population
population_2010 <- get_decennial(geography = "state",
sumfile = "sf1",
variables = "B01003_001",
year = 2010)
cancer_trials_us_single <- cancer_trials_us_single %>%
mutate(state = intersect(Locations,state.name))
intersect(Locations,state.name)
View(cancer_trials_us_single)
cancer_trials_us_single <- cancer_trials_us_single %>%
mutate(state = Locations %in% state.name)
View(cancer_trials_us_single)
# this creates a new column for state for trials conducted in only one state
cancer_trials_us_single_edit <- data_frame()
for (state in state_name) {
print(state)
tmp <- cancer_trials_us_single %>%
filter(state %in% Locations) %>%
mutate(state = state)
bind_rows(cancer_trials_us_single_edit,tmp)
}
for (state in state.name) {
print(state)
tmp <- cancer_trials_us_single %>%
filter(state %in% Locations) %>%
mutate(state = state)
bind_rows(cancer_trials_us_single_edit,tmp)
}
# this creates a new column for state for trials conducted in only one state
cancer_trials_us_single_edit <- data_frame()
for (state in state.name) {
print(state)
tmp <- cancer_trials_us_single %>%
filter(state %in% Locations == TRUE) %>%
mutate(state = state)
bind_rows(cancer_trials_us_single_edit,tmp)
}
state %in% Locations == TRUE
for (state in state.name) {
print(state)
tmp <- cancer_trials_us_single %>%
filter(grepl(state, Locations) %>%
mutate(state = state)
bind_rows(cancer_trials_us_single_edit,tmp)
}
cancer_trials_us_single_edit <- data_frame()
for (state in state.name) {
print(state)
tmp <- cancer_trials_us_single %>%
filter(grepl(state, Locations)) %>%
mutate(state = state)
bind_rows(cancer_trials_us_single_edit,tmp)
}
state
tmp <- cancer_trials_us_single %>%
filter(grepl(state, Locations))
cancer_trials_us_single <- cancer_trials %>%
filter(number_states == 1)
cancer_trials_us_single <- cancer_trials_us %>%
filter(number_states == 1)
# this creates a new column for state for trials conducted in only one state
cancer_trials_us_single_edit <- data_frame()
for (state in state.name) {
print(state)
tmp <- cancer_trials_us_single %>%
filter(grepl(state, Locations)) %>%
mutate(state = state)
bind_rows(cancer_trials_us_single_edit,tmp)
}
cancer_trials_us_single
View(cancer_trials_us_single)
state
cancer_trials_us_single <- cancer_trials_us %>%
filter(number_states == 1) %>%
mutate(state = grep(state,Locations))
for (state in state.name) {
print(state)
# tmp <- cancer_trials_us_single %>%
#   filter(grepl(state, Locations)) %>%
#   mutate(state = state)
# bind_rows(cancer_trials_us_single_edit,tmp)
}
for (state in state.name) {
print(state)
tmp <- cancer_trials_us_single %>%
filter(grepl(state, Locations)) %>%
mutate(state = state)
bind_rows(cancer_trials_us_single_edit,tmp)
}
for (state in state.name) {
print(state)
tmp <- cancer_trials_us_single %>%
filter(grepl(state,Locations)) %>%
mutate(state = state)
bind_rows(cancer_trials_us_single_edit,tmp)
}
cancer_trials_us_single <- cancer_trials_us %>%
filter(number_states == 1)
for (state in state.name) {
print(state)
tmp <- cancer_trials_us_single %>%
filter(grepl(state,Locations)) %>%
mutate(state = state)
bind_rows(cancer_trials_us_single_edit,tmp)
}
tmp <- cancer_trials_us_single %>%
filter(grepl("California",Locations))
for (s in state.name) {
print(s)
tmp <- cancer_trials_us_single %>%
filter(grepl(s,Locations)) %>%
mutate(state = s)
bind_rows(cancer_trials_us_single_edit,tmp)
}
state.name
cancer_trials_us_single_edit <- data_frame()
tmp <- cancer_trials_us_single %>%
mutate(state = gsub("^Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming","",Locations))
View(tmp)
tmp <- cancer_trials_us_single %>%
mutate(state = gsub(!"Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming","",Locations))
tmp <- cancer_trials_us_single %>%
mutate(state = gsub("^Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming+","",Locations))
View(tmp)
tmp <- cancer_trials_us_single %>%
mutate(state = gsub("!Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming+","",Locations))
View(tmp)
tmp <- cancer_trials_us_single %>%
mutate(state = gsub(^"Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming+","",Locations))
tmp <- cancer_trials_us_single %>%
mutate(state = gsub("^Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming+","",Locations))
View(tmp)
